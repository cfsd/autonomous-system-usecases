# it includes ZED camera, data recording, perception microservices
version: '2.3'

services: 
    video-h264-encoder-amd64:
        #build:
            #context: https://github.com/chalmers-revere/opendlv-video-h264-encoder.git
            #dockerfile: Dockerfile.amd64
        image: video-h264-encoder-amd64:latest
        restart: on-failure
        network_mode: "host"
        ipc: "host"
        volumes:
        - /tmp:/tmp
        command: "--cid=${CID} --name=${video}.i420 --width=1344 --height=376 --verbose"

    proxy-camera:
        image: chalmersrevere/opendlv-device-camera-v4l-multi:v0.0.8
        network_mode: host
        group_add:
           - video
        ipc: host
        user: root
        devices:
           - "/dev/${video}:/dev/video0"
        environment:
           - DISPLAY=$DISPLAY
        volumes:
           - /tmp/.X11-unix:/tmp/.X11-unix
           - /tmp:/tmp
        command: "--camera=/dev/video0 --width=1344 --height=376 --freq=100 --verbose"


#    recorder:
#       image: chrberger/cluon-amd64:latest
#       network_mode: "host"
#       volumes:
#       - ./recordings${CID}cluon:/opt/recordings
#       working_dir: "/opt/recordings"
#       command: sh -c "cluon-OD4toStdout --cid=${CID} > `date +CID-${CID}-proxy-recording-%Y-%m-%d_%H%M%S.rec`"

